<%- include("partials/header"); -%>

<table class="table table-hover text-center">
  <thead>
    <tr>
      <th class="text-center"><input type="checkbox" onClick="toggle(this)" hover="Select"></th>
      <th class="text-center">BOL No</th>
      <th class="text-center">Customer</th>
      <th class="text-center">Shipping From</th>
      <th class="text-center">Delivery To</th>
      <th class="text-center">Carrier</th>
      <th class="text-center">Freight</th>
      <th class="text-center">Weight(Kg)</th>
      <th class="text-center">Weight(Lb)</th>
    </tr>
  </thead>

  <tbody>

    <!-- compare shipping dates in the array of javascript object and sort it in ascending order -->
    <% function compare_date(a, b) { %>
      <% if (a.shippingDate < b.shippingDate) { %>
        <% return -1; %>
      <% } else if (a.shippingDate > b.shippingDate) { %>
        <% return 1; %>
      <% } else { %>
        <% return 0; %>
      <% } %>
    <% }; %>

    <% function numberWithCommas(n) { %>
        <% return n.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ","); %>
    <% }; %>


    <% requests.sort(compare_date).forEach(function(request) { %>
      <% freights.forEach(function(freight) { %>

        <% if (request._id.equals(freight.request_id)) { %>
          <tr>
            <th class="text-center"><input type="checkbox" name="checkbox" value="<%=request._id%>" form="delete-form"></th>
            <td><a href="/freight-detail/<%= request._id %>"><%= request.bolNo %></a></td>
            <td><%= request.customer %></td>
            <td><%= request.shippingFrom %></td>
            <td><%= request.deliveryTo %></td>
            <td><%= freight.carrier %></td>
            <td>$<%= numberWithCommas(freight.freight.toFixed(2)) %></td>
            <td><%= numberWithCommas(request.weightKg) %></td>
            <td><%= numberWithCommas(request.weightLb) %></td>
          </tr>
        <% } %>
      <% }) %>
    <% }) %>

  </tbody>
</table>

<%- include("partials/footer"); -%>
