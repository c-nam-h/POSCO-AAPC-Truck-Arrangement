<%- include("partials/header"); -%>
<%- include("partials/navbar"); -%>

<body>
  <div class="container">
    <div class="title">
      <h2 class="homepage-title-heading" style="display: inline;">Freight Report</h2>
      <button class="export-csv-btn" onclick="exportTableToCSV('freight_report.csv')" name="button">Export to CSV File</button>
      <div class="dropdown dropdown-div">
        <button class="btn btn-secondary dropdown-toggle filter-button-report" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Shipping Status
        </button>
        <div class="dropdown-menu dropdown-menu-right filter" aria-labelledby="dropdownMenuButton">
          <button class="dropdown-item filter" onclick="shippingStatusFilter('all')">All</button>
          <button class="dropdown-item filter" onclick="shippingStatusFilter('notShipped')">Not Shipped</button>
          <button class="dropdown-item filter" onclick="shippingStatusFilter('shipped')">Shipped</button>
        </div>
      </div>
    </div>

    
    <br>

    <table class="table table-hover text-center">
      <thead>
        <tr class="shipped notShipped">
          <th class="text-center"><input type="checkbox" onClick="toggle(this)" hover="Select"></th>
          <th class="text-center">Shipping Date</th>
          <th class="text-center">BOL No</th>
          <th class="text-center">Ship From</th>
          <th class="text-center">Delivery To</th>
          <th class="text-center">Weight(Kg)</th>
          <th class="text-center">Weight(Lb)</th>
          <th class="text-center">Status</th>
          <th class="text-center">Carrier</th>
          <th class="text-center">Freight</th>
        </tr>
      </thead>

    <tbody>
      <% requests.forEach(function(request) { %>
        <% freights.forEach(function(freight) { %>
          <% if (request._id.equals(freight.request_id)) { %>
            <% if (request.status === "Shipped") { %>
              <tr class="shipped">
                <th class="text-center"><input type="checkbox" name="checkbox" value="<%=request._id%>" form="delete-form"></th>
                <td><%= request.shippingDate %></td>
                <td><%= request.bolNo %></td>
                <td><%= request.shipFromCity %> <%= request.shipFromState %></td>
                <td><%= request.shipToCity %> <%= request.shipToState %></td>
                <td><%= request.weightKg %></td>
                <td><%= request.weightLb %></td>
                <td><%= request.status %></td>
                <td><%= freight.carrier %></td>
                <td>$<%= freight.freight.toFixed(2) %></td>
              </tr>
            <% } else { %>
              <tr class="notShipped">
                <th class="text-center"><input type="checkbox" name="checkbox" value="<%=request._id%>" form="delete-form"></th>
                <td><%= request.shippingDate %></td>
                <td><%= request.bolNo %></td>
                <td><%= request.shipFromCity %> <%= request.shipFromState %></td>
                <td><%= request.shipToCity %> <%= request.shipToState %></td>
                <td><%= request.weightKg %></td>
                <td><%= request.weightLb %></td>
                <td><%= request.status %></td>
                <td><%= freight.carrier %></td>
                <td>$<%= freight.freight.toFixed(2) %></td>
              </tr>
            <% } %>
          <% } %>
        <% }) %>
      <% }) %>

    </tbody>
  </table>
</div>

<%- include("partials/footer"); -%>
<%- include("partials/scripts"); -%>
<script src="/javascript/shippingStatusFilterReport.js"></script>
</body>

</html>

